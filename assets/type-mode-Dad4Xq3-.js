var W=Object.defineProperty;var R=(n,s,o)=>s in n?W(n,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[s]=o;var b=(n,s,o)=>R(n,typeof s!="symbol"?s+"":s,o);import{j as e,r as x,B as S,b as E,e as G,c as M,a as T,u as F,f as L}from"./index-3ZbFfPyt.js";import{a as z,b as P}from"./index-CrfKh4Ap.js";import{d as A,p as D,a as V}from"./index-DzdeVqn3.js";function _(n){let s={};return e.jsx("textarea",{style:s,onChange:n.onChange,className:"min-h-24 min-w-12 bg-stone-800 rounded-lg text-white font-medium p-3 focus:outline-stone-400 focus:outline-2 inset-shadow-md "+(n.className||"")})}function O(n){return e.jsxs("div",{className:"h-12",children:[e.jsx("p",{className:"text-sm font-thin",children:n.label}),e.jsx("p",{className:"text-2xl font-medium",children:n.children})]})}class I{constructor(s,o,r,u,h){b(this,"characters","");b(this,"isWord",!1);b(this,"isDone",!1);b(this,"isGuessed",!1);b(this,"index",0);this.characters=s,this.isWord=o,this.isDone=r,this.isGuessed=u,this.index=h}getDuplicate(){return new I(this.characters,this.isWord,this.isDone,this.isGuessed,this.index)}}function B(n){const[s,o]=x.useState({}),[r,u]=x.useState(null),[h,f]=x.useState(""),j=x.useRef(null),y=(l=!1)=>{const a={...s},t=r==null?void 0:r.getDuplicate();t.isDone=!0,t.isGuessed=!l,a[t.index]=t,o(a);let d=null;Object.keys(a).forEach(i=>{d==null&&parseInt(i)>t.index&&a[parseInt(i)].isWord&&!a[parseInt(i)].isDone&&(d=parseInt(i))}),d!=null?u(a[d]):u(null)},k=()=>{if(g){const l=[];Object.keys(s).forEach(a=>{const t=s[parseInt(a)];t.isWord&&t.isDone&&l.push({index:parseInt(a),word:t.characters,guessed:t.isGuessed})}),n.onSave(l)}},[w,C,p]=(()=>{let l=0,a=0,t=0;return Object.keys(s).map(d=>{s[parseInt(d)].isWord&&s[parseInt(d)].isDone&&(t+=1,s[parseInt(d)].isGuessed?l+=1:a+=1)}),[l,a,t]})();x.useEffect(()=>{const l={};let a=n.material;Object.keys(A).sort(function(c,m){return m.length-c.length}).forEach(c=>{let m="";for(let v=0;v<c.length;v++)m+="¬";Y(a,c).forEach(v=>{a=a.replace(c,m),l[v]=new I(c,!0,!1,!1,v)})}),a.split("").forEach((c,m)=>{c!="¬"&&(l[m]=new I(c,/[\u4e00-\u9fff]/.test(c),!1,!1,m))});const i={};Object.keys(l).sort(function(c,m){return parseInt(c)-parseInt(m)}).forEach(c=>{i[parseInt(c)]=l[parseInt(c)]}),o(i),Object.keys(i).length>0&&u(i[parseInt(Object.keys(i)[0])])},[n.material]);const N=x.useMemo(()=>{let l=[];return Object.keys(s).sort(function(a,t){return parseInt(a)-parseInt(t)}).forEach(a=>{const t=s[parseInt(a)];if(/[\u4e00-\u9fff]/.test(t.characters)){let d="inline-block text-center px-0.5 bg-stone-600 rounded-sm mx-0.5 mt-1 h-15";t.index==(r==null?void 0:r.index)?d="inline-block text-center px-0.5 bg-cyan-200 text-black rounded-sm mx-0.5 mt-1 w-9 h-15":t.isDone&&(d="inline-block text-center px-0.5 bg-stone-500 rounded-sm mx-0.5 mt-1 w-9 h-15 "+(t.isGuessed?"text-green-300":"text-red-300"));const i=D(t.characters).toString().replace(",","");l.push(e.jsxs("div",{className:d,style:{width:.25*9*t.characters.length+"rem"},children:[e.jsx("strong",{children:t.characters}),e.jsxs("span",{className:"italic select-none",style:{fontSize:q(i.length)},children:[e.jsx("br",{}),t.isWord&&!t.isDone?i.split("").map(()=>"_").join(""):i]})]},t.characters+a))}else l.push(t.characters)}),l},[s]),g=x.useMemo(()=>{let l=!0;return Object.keys(s).forEach(a=>{s[parseInt(a)].isWord&&!s[parseInt(a)].isDone&&(l=!1)}),l},[s]);return e.jsxs("div",{className:"mx-auto container flex flex-col",children:[e.jsx("div",{className:"flex flex-col",children:e.jsx("div",{className:"bg-stone-700 rounded-lg w-full p-2 font-medium mb-2 whitespace-break-spaces text-xl",style:{verticalAlign:"top"},children:N})}),e.jsx("div",{className:"flex-grow my-4"}),e.jsx("div",{className:"sticky w-full md:w-auto bottom-0 md:bottom-4 md:mb-4 mx-auto p-3 bg-stone-700 flex flex-row gap-2 rounded-xl lg:pb-8",style:{boxShadow:"0px 0px 10px rgba(0,0,0,0.5)"},children:r!=null?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col text-center",children:[e.jsx("p",{className:"font-bold text-xs whitespace-nowrap mb-2",children:"WORD"}),e.jsx("button",{className:"font-bold text-3xl px-4 py-2 rounded-md bg-stone-500 cursor-pointer hover:brightness-105",onClick:()=>{window.open("https://www.mdbg.net/chinese/dictionary?page=worddict&email=&wdrst=0&wdqb="+r.characters,"_blank").focus()},children:r.characters})]}),e.jsxs("div",{className:"flex flex-col flex-grow text-center",children:[e.jsx("p",{className:"font-bold text-xs whitespace-nowrap mb-2",children:"PINYIN"}),e.jsx("input",{autoCapitalize:"none",ref:j,className:"px-4 py-2 rounded-md outline-0 flex-grow text-2xl w-full text-center text-black bg-stone-400",value:h,onChange:l=>{r!=null&&r.characters&&D(r.characters,{style:0}).toString().replace(",","")==l.target.value.toLowerCase()?(f(""),y()):f(l.target.value)}})]}),e.jsxs("div",{className:"flex flex-col text-center",children:[e.jsx("p",{className:"font-bold text-xs whitespace-nowrap mb-2",children:"SKIP"}),e.jsx(S,{className:"w-16 h-full flex flex-col justify-center items-center",onClick:()=>{y(!0),j.current&&j.current.focus()},children:e.jsx(V,{size:"24"})})]})]}):g?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col text-center flex-grow",children:[e.jsx("p",{className:"font-bold text-xs whitespace-nowrap mb-2",children:"RIGHT"}),e.jsx("div",{className:"p-3 bg-stone-500 rounded-md text-green-300 font-extrabold",children:w})]}),e.jsxs("div",{className:"flex flex-col text-center flex-grow",children:[e.jsx("p",{className:"font-bold text-xs whitespace-nowrap mb-2",children:"WRONG"}),e.jsx("div",{className:"p-3 bg-stone-500 rounded-md text-red-300 font-extrabold",children:C})]}),e.jsxs("div",{className:"flex flex-col text-center flex-grow",children:[e.jsx("p",{className:"font-bold text-xs whitespace-nowrap mb-2",children:"SCORE"}),e.jsxs("div",{className:"p-3 bg-stone-500 rounded-md font-extrabold",children:[w," / ",p]})]}),e.jsxs("div",{className:"flex flex-col text-center",children:[e.jsx("p",{className:"font-bold text-xs whitespace-nowrap mb-2",children:"SAVE"}),e.jsx(S,{disabled:!1,className:"px-6",onClick:()=>{k()},children:e.jsx(z,{})})]})]}):e.jsx(e.Fragment,{})})]})}function Y(n,s){const o=[];let r=!0,u=0;for(;r;){const h=n.indexOf(s,u);h!==-1?(o.push(h),u=h+1):r=!1}return o}function q(n){switch(n){case 1:case 2:return 15;case 3:return 13;case 4:return 12;default:case 5:return 9}}function X(){const n=E(G),s=E(M),o=T(),r=F(),[u,h]=x.useState(""),[f,j]=x.useState(""),y=()=>{f&&h(f)},k=x.useRef(n);x.useEffect(()=>{!n&&k.current&&r("/"),k.current=n},[n]);const w=x.useMemo(()=>(f.match(/[\u4e00-\u9fff]/g)||[]).length,[f]),C=x.useMemo(()=>{const p=f.match(/[\u4e00-\u9fff]/g)||[];let N=[];return p.forEach(g=>{!Object.keys(s).includes(g)&&!N.includes(g)&&N.push(g)}),N.length},[f]);return e.jsx("div",{className:"w-full min-h-full flex",children:u?e.jsx(B,{material:u,onSave:p=>{o(L(p))}}):e.jsx("div",{className:"container min-h-full mx-auto flex flex-col",children:e.jsxs("div",{className:"min-h-full md:h-auto flex flex-col md:flex-row justify-center bg-stone-700 p-3 rounded-md shadow-md gap-3 flex-wrap md:flex-nowrap",children:[e.jsxs("div",{className:"w-full md:w-2/3 flex flex-col flex-grow",children:[e.jsx("p",{className:"font-bold text-sm mb-2",children:"Paste what you want to type below"}),e.jsx(_,{value:f,onChange:p=>{j(p.target.value)},className:"bg-stone-800 rounded-md w-full font-medium flex-grow min-h-56 md:min-h-100 h-auto resize-none",spellCheck:"false"})]}),e.jsxs("div",{className:"w-full md:w-1/3 flex flex-col",children:[e.jsx("div",{className:"bg-stone-600 p-2 rounded-md mb-3 shadow-md",children:e.jsx(O,{label:"Total characters",children:e.jsx("span",{style:{color:"var(--primary)"},children:w})})}),e.jsx("div",{className:"bg-stone-600 p-2 rounded-md mb-3 shadow-md",children:e.jsx(O,{label:"New characters",children:e.jsx("span",{style:{color:"var(--primary)"},children:C})})}),e.jsx("div",{className:"flex-grow"}),e.jsx(S,{disabled:w<=0,onClick:y,className:"w-full font-medium",children:e.jsxs("div",{className:"flex m-auto justify-center items-center gap-2",children:[e.jsx(P,{})," START TYPING"]})})]})]})})})}export{X as default};
