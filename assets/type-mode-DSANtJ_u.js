var S=Object.defineProperty;var W=(r,s,o)=>s in r?S(r,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):r[s]=o;var h=(r,s,o)=>W(r,typeof s!="symbol"?s+"":s,o);import{j as e,r as i,B as y,a as I,f as D,d as T,b as E,u as R,g as G}from"./index-gRQCLBHx.js";import{b as M,L as k,c as O}from"./labeled-value-DSqFUQOx.js";import{W as F,T as L,a as P}from"./word-container-DreFMgiV.js";import{s as A}from"./functions-B78AmXaJ.js";function z(r){let s={};return e.jsx("textarea",{style:s,onChange:r.onChange,className:"min-h-24 min-w-12 bg-neutral-800 rounded-lg text-white font-medium p-3 focus:outline-neutral-400 focus:outline-2 inset-shadow-md "+(r.className||"")})}class C{constructor(s,o,n,u,m){h(this,"characters","");h(this,"isWord",!1);h(this,"isDone",!1);h(this,"isGuessed",!1);h(this,"index",0);this.characters=s,this.isWord=o,this.isDone=n,this.isGuessed=u,this.index=m}getDuplicate(){return new C(this.characters,this.isWord,this.isDone,this.isGuessed,this.index)}}function V(r){const[s,o]=i.useState({}),[n,u]=i.useState(null),[m,d]=i.useState(""),p=i.useRef(null),b=(a=!1)=>{const l={...s},t=n==null?void 0:n.getDuplicate();t.isDone=!0,t.isGuessed=!a,l[t.index]=t,o(l);let c=null;Object.keys(l).forEach(N=>{c==null&&parseInt(N)>t.index&&l[parseInt(N)].isWord&&!l[parseInt(N)].isDone&&(c=parseInt(N))}),c!=null?u(l[c]):u(null)},j=()=>{if(f){const a=[];Object.keys(s).forEach(l=>{const t=s[parseInt(l)];t.isWord&&t.isDone&&a.push({index:parseInt(l),word:t.characters,guessed:t.isGuessed})}),r.onSave(a)}},[g,v,x]=(()=>{let a=0,l=0,t=0;return Object.keys(s).map(c=>{s[parseInt(c)].isWord&&s[parseInt(c)].isDone&&(t+=1,s[parseInt(c)].isGuessed?a+=1:l+=1)}),[a,l,t]})();i.useEffect(()=>{const a={};A(r.material).forEach((t,c)=>{a[c]=new C(t,/[\u4e00-\u9fff]/.test(t),!1,!1,c)}),o(a),Object.keys(a).length>0&&u(a[parseInt(Object.keys(a)[0])])},[r.material]);const w=i.useMemo(()=>{let a=[];return Object.keys(s).sort(function(l,t){return parseInt(l)-parseInt(t)}).forEach(l=>{const t=s[parseInt(l)];if(/[\u4e00-\u9fff]/.test(t.characters)){let c="basic";t.index==(n==null?void 0:n.index)?c="typing":t.isDone&&(t.isGuessed?c="highlighted":c="wrong"),a.push(e.jsx(F,{className:"inline-block",hanzi:t.characters,type:c,guessing:!t.isDone}))}else a.push(t.characters)}),a},[s]),f=i.useMemo(()=>{let a=!0;return Object.keys(s).forEach(l=>{s[parseInt(l)].isWord&&!s[parseInt(l)].isDone&&(a=!1)}),a},[s]);return e.jsxs("div",{className:"mx-auto container flex flex-col",children:[e.jsx("div",{className:"flex flex-col",children:e.jsx("div",{className:"bg-neutral-700 rounded-lg w-full p-2 font-medium mb-2 whitespace-break-spaces text-xl",style:{verticalAlign:"top"},children:w})}),e.jsx("div",{className:"flex-grow my-4"}),e.jsx("div",{className:"sticky w-full md:w-auto bottom-0 md:bottom-4 md:mb-4 mx-auto p-3 bg-neutral-700 flex flex-row gap-2 rounded-xl lg:pb-8",style:{boxShadow:"0px 0px 10px rgba(0,0,0,0.5)"},children:n!=null?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col text-center",children:[e.jsx("p",{className:"font-bold text-xs whitespace-nowrap mb-2",children:"WORD"}),e.jsx("button",{className:"font-bold text-3xl px-4 py-2 rounded-md bg-neutral-500 cursor-pointer hover:brightness-105 whitespace-nowrap",onClick:()=>{window.open("https://www.mdbg.net/chinese/dictionary?page=worddict&email=&wdrst=0&wdqb="+n.characters,"_blank").focus()},children:n.characters})]}),e.jsxs("div",{className:"flex flex-col flex-grow text-center",children:[e.jsx("p",{className:"font-bold text-xs whitespace-nowrap mb-2",children:"PINYIN"}),e.jsx("input",{autoCapitalize:"none",ref:p,className:"px-4 py-2 rounded-md outline-0 flex-grow text-2xl w-full text-center text-black bg-neutral-400",value:m,onChange:a=>{n!=null&&n.characters&&L(n.characters,{toneless:!0})==a.target.value.toLowerCase()?(d(""),b()):d(a.target.value)}})]}),e.jsxs("div",{className:"flex flex-col text-center",children:[e.jsx("p",{className:"font-bold text-xs whitespace-nowrap mb-2",children:"SKIP"}),e.jsx(y,{className:"w-16 h-full flex flex-col justify-center items-center",onClick:()=>{b(!0),p.current&&p.current.focus()},children:e.jsx(P,{size:"24"})})]})]}):f?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col text-center flex-grow",children:[e.jsx("p",{className:"font-bold text-xs whitespace-nowrap mb-2",children:"RIGHT"}),e.jsx("div",{className:"p-3 bg-neutral-500 rounded-md text-green-300 font-extrabold",children:g})]}),e.jsxs("div",{className:"flex flex-col text-center flex-grow",children:[e.jsx("p",{className:"font-bold text-xs whitespace-nowrap mb-2",children:"WRONG"}),e.jsx("div",{className:"p-3 bg-neutral-500 rounded-md text-red-300 font-extrabold",children:v})]}),e.jsxs("div",{className:"flex flex-col text-center flex-grow",children:[e.jsx("p",{className:"font-bold text-xs whitespace-nowrap mb-2",children:"SCORE"}),e.jsxs("div",{className:"p-3 bg-neutral-500 rounded-md font-extrabold",children:[g," / ",x]})]}),e.jsxs("div",{className:"flex flex-col text-center",children:[e.jsx("p",{className:"font-bold text-xs whitespace-nowrap mb-2",children:"SAVE"}),e.jsx(y,{disabled:!1,className:"px-6",onClick:()=>{j()},children:e.jsx(M,{})})]})]}):e.jsx(e.Fragment,{})})]})}function J(){const r=I(D),s=I(T),o=E(),n=R(),[u,m]=i.useState(""),[d,p]=i.useState(""),b=()=>{d&&m(d)},j=i.useRef(r);i.useEffect(()=>{!r&&j.current&&n("/"),j.current=r},[r]);const g=i.useMemo(()=>(d.match(/[\u4e00-\u9fff]/g)||[]).length,[d]),v=i.useMemo(()=>{const x=d.match(/[\u4e00-\u9fff]/g)||[];let w=[];return x.forEach(f=>{!Object.keys(s).includes(f)&&!w.includes(f)&&w.push(f)}),w.length},[d]);return e.jsx("div",{className:"w-full min-h-full flex",children:u?e.jsx(V,{material:u,onSave:x=>{o(G(x))}}):e.jsx("div",{className:"container min-h-full mx-auto flex flex-col",children:e.jsxs("div",{className:"min-h-full md:h-auto flex flex-col md:flex-row justify-center bg-neutral-700 p-3 rounded-md shadow-md gap-3 flex-wrap md:flex-nowrap",children:[e.jsxs("div",{className:"w-full md:w-2/3 flex flex-col flex-grow",children:[e.jsx("p",{className:"font-bold text-sm mb-2",children:"Paste what you want to type below"}),e.jsx(z,{value:d,onChange:x=>{p(x.target.value)},className:"bg-neutral-800 rounded-md w-full font-medium flex-grow min-h-56 md:min-h-100 h-auto resize-none",spellCheck:"false"})]}),e.jsxs("div",{className:"w-full md:w-1/3 flex flex-col",children:[e.jsx("div",{className:"bg-neutral-600 p-2 rounded-md mb-3 shadow-md",children:e.jsx(k,{label:"Total characters",children:e.jsx("span",{style:{color:"var(--primary)"},children:g})})}),e.jsx("div",{className:"bg-neutral-600 p-2 rounded-md mb-3 shadow-md",children:e.jsx(k,{label:"New characters",children:e.jsx("span",{style:{color:"var(--primary)"},children:v})})}),e.jsx("div",{className:"flex-grow"}),e.jsx(y,{disabled:g<=0,onClick:b,className:"w-full font-medium",children:e.jsxs("div",{className:"flex m-auto justify-center items-center gap-2",children:[e.jsx(O,{})," START TYPING"]})})]})]})})})}export{J as default};
