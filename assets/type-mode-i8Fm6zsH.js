var D=Object.defineProperty;var O=(n,s,i)=>s in n?D(n,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[s]=i;var w=(n,s,i)=>O(n,typeof s!="symbol"?s+"":s,i);import{j as e,r as d,B as S,a as E,f as R,d as T,b as G,u as M,g as L}from"./index-CbzCPSk_.js";import{b as F,L as W,c as P}from"./labeled-value-DJqUyiTE.js";import{d as z,W as A,T as V,a as _}from"./word-container-BsCd0c96.js";function B(n){let s={};return e.jsx("textarea",{style:s,onChange:n.onChange,className:"min-h-24 min-w-12 bg-neutral-800 rounded-lg text-white font-medium p-3 focus:outline-neutral-400 focus:outline-2 inset-shadow-md "+(n.className||"")})}class I{constructor(s,i,r,u,h){w(this,"characters","");w(this,"isWord",!1);w(this,"isDone",!1);w(this,"isGuessed",!1);w(this,"index",0);this.characters=s,this.isWord=i,this.isDone=r,this.isGuessed=u,this.index=h}getDuplicate(){return new I(this.characters,this.isWord,this.isDone,this.isGuessed,this.index)}}function Y(n){const[s,i]=d.useState({}),[r,u]=d.useState(null),[h,f]=d.useState(""),b=d.useRef(null),y=(l=!1)=>{const t={...s},a=r==null?void 0:r.getDuplicate();a.isDone=!0,a.isGuessed=!l,t[a.index]=a,i(t);let o=null;Object.keys(t).forEach(x=>{o==null&&parseInt(x)>a.index&&t[parseInt(x)].isWord&&!t[parseInt(x)].isDone&&(o=parseInt(x))}),o!=null?u(t[o]):u(null)},C=()=>{if(g){const l=[];Object.keys(s).forEach(t=>{const a=s[parseInt(t)];a.isWord&&a.isDone&&l.push({index:parseInt(t),word:a.characters,guessed:a.isGuessed})}),n.onSave(l)}},[j,k,p]=(()=>{let l=0,t=0,a=0;return Object.keys(s).map(o=>{s[parseInt(o)].isWord&&s[parseInt(o)].isDone&&(a+=1,s[parseInt(o)].isGuessed?l+=1:t+=1)}),[l,t,a]})();d.useEffect(()=>{const l={};let t=n.material;Object.keys(z).sort(function(c,m){return m.length-c.length}).forEach(c=>{let m="";for(let v=0;v<c.length;v++)m+="¬";q(t,c).forEach(v=>{t=t.replace(c,m),l[v]=new I(c,!0,!1,!1,v)})}),t.split("").forEach((c,m)=>{c!="¬"&&(l[m]=new I(c,/[\u4e00-\u9fff]/.test(c),!1,!1,m))});const x={};Object.keys(l).sort(function(c,m){return parseInt(c)-parseInt(m)}).forEach(c=>{x[parseInt(c)]=l[parseInt(c)]}),i(x),Object.keys(x).length>0&&u(x[parseInt(Object.keys(x)[0])])},[n.material]);const N=d.useMemo(()=>{let l=[];return Object.keys(s).sort(function(t,a){return parseInt(t)-parseInt(a)}).forEach(t=>{const a=s[parseInt(t)];if(/[\u4e00-\u9fff]/.test(a.characters)){let o="basic";a.index==(r==null?void 0:r.index)?o="typing":a.isDone&&(a.isGuessed?o="highlighted":o="wrong"),l.push(e.jsx(A,{className:"inline-block",hanzi:a.characters,type:o,guessing:!a.isDone}))}else l.push(a.characters)}),l},[s]),g=d.useMemo(()=>{let l=!0;return Object.keys(s).forEach(t=>{s[parseInt(t)].isWord&&!s[parseInt(t)].isDone&&(l=!1)}),l},[s]);return e.jsxs("div",{className:"mx-auto container flex flex-col",children:[e.jsx("div",{className:"flex flex-col",children:e.jsx("div",{className:"bg-neutral-700 rounded-lg w-full p-2 font-medium mb-2 whitespace-break-spaces text-xl",style:{verticalAlign:"top"},children:N})}),e.jsx("div",{className:"flex-grow my-4"}),e.jsx("div",{className:"sticky w-full md:w-auto bottom-0 md:bottom-4 md:mb-4 mx-auto p-3 bg-neutral-700 flex flex-row gap-2 rounded-xl lg:pb-8",style:{boxShadow:"0px 0px 10px rgba(0,0,0,0.5)"},children:r!=null?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col text-center",children:[e.jsx("p",{className:"font-bold text-xs whitespace-nowrap mb-2",children:"WORD"}),e.jsx("button",{className:"font-bold text-3xl px-4 py-2 rounded-md bg-neutral-500 cursor-pointer hover:brightness-105 whitespace-nowrap",onClick:()=>{window.open("https://www.mdbg.net/chinese/dictionary?page=worddict&email=&wdrst=0&wdqb="+r.characters,"_blank").focus()},children:r.characters})]}),e.jsxs("div",{className:"flex flex-col flex-grow text-center",children:[e.jsx("p",{className:"font-bold text-xs whitespace-nowrap mb-2",children:"PINYIN"}),e.jsx("input",{autoCapitalize:"none",ref:b,className:"px-4 py-2 rounded-md outline-0 flex-grow text-2xl w-full text-center text-black bg-neutral-400",value:h,onChange:l=>{r!=null&&r.characters&&V(r.characters,{toneless:!0})==l.target.value.toLowerCase()?(f(""),y()):f(l.target.value)}})]}),e.jsxs("div",{className:"flex flex-col text-center",children:[e.jsx("p",{className:"font-bold text-xs whitespace-nowrap mb-2",children:"SKIP"}),e.jsx(S,{className:"w-16 h-full flex flex-col justify-center items-center",onClick:()=>{y(!0),b.current&&b.current.focus()},children:e.jsx(_,{size:"24"})})]})]}):g?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col text-center flex-grow",children:[e.jsx("p",{className:"font-bold text-xs whitespace-nowrap mb-2",children:"RIGHT"}),e.jsx("div",{className:"p-3 bg-neutral-500 rounded-md text-green-300 font-extrabold",children:j})]}),e.jsxs("div",{className:"flex flex-col text-center flex-grow",children:[e.jsx("p",{className:"font-bold text-xs whitespace-nowrap mb-2",children:"WRONG"}),e.jsx("div",{className:"p-3 bg-neutral-500 rounded-md text-red-300 font-extrabold",children:k})]}),e.jsxs("div",{className:"flex flex-col text-center flex-grow",children:[e.jsx("p",{className:"font-bold text-xs whitespace-nowrap mb-2",children:"SCORE"}),e.jsxs("div",{className:"p-3 bg-neutral-500 rounded-md font-extrabold",children:[j," / ",p]})]}),e.jsxs("div",{className:"flex flex-col text-center",children:[e.jsx("p",{className:"font-bold text-xs whitespace-nowrap mb-2",children:"SAVE"}),e.jsx(S,{disabled:!1,className:"px-6",onClick:()=>{C()},children:e.jsx(F,{})})]})]}):e.jsx(e.Fragment,{})})]})}function q(n,s){const i=[];let r=!0,u=0;for(;r;){const h=n.indexOf(s,u);h!==-1?(i.push(h),u=h+1):r=!1}return i}function X(){const n=E(R),s=E(T),i=G(),r=M(),[u,h]=d.useState(""),[f,b]=d.useState(""),y=()=>{f&&h(f)},C=d.useRef(n);d.useEffect(()=>{!n&&C.current&&r("/"),C.current=n},[n]);const j=d.useMemo(()=>(f.match(/[\u4e00-\u9fff]/g)||[]).length,[f]),k=d.useMemo(()=>{const p=f.match(/[\u4e00-\u9fff]/g)||[];let N=[];return p.forEach(g=>{!Object.keys(s).includes(g)&&!N.includes(g)&&N.push(g)}),N.length},[f]);return e.jsx("div",{className:"w-full min-h-full flex",children:u?e.jsx(Y,{material:u,onSave:p=>{i(L(p))}}):e.jsx("div",{className:"container min-h-full mx-auto flex flex-col",children:e.jsxs("div",{className:"min-h-full md:h-auto flex flex-col md:flex-row justify-center bg-neutral-700 p-3 rounded-md shadow-md gap-3 flex-wrap md:flex-nowrap",children:[e.jsxs("div",{className:"w-full md:w-2/3 flex flex-col flex-grow",children:[e.jsx("p",{className:"font-bold text-sm mb-2",children:"Paste what you want to type below"}),e.jsx(B,{value:f,onChange:p=>{b(p.target.value)},className:"bg-neutral-800 rounded-md w-full font-medium flex-grow min-h-56 md:min-h-100 h-auto resize-none",spellCheck:"false"})]}),e.jsxs("div",{className:"w-full md:w-1/3 flex flex-col",children:[e.jsx("div",{className:"bg-neutral-600 p-2 rounded-md mb-3 shadow-md",children:e.jsx(W,{label:"Total characters",children:e.jsx("span",{style:{color:"var(--primary)"},children:j})})}),e.jsx("div",{className:"bg-neutral-600 p-2 rounded-md mb-3 shadow-md",children:e.jsx(W,{label:"New characters",children:e.jsx("span",{style:{color:"var(--primary)"},children:k})})}),e.jsx("div",{className:"flex-grow"}),e.jsx(S,{disabled:j<=0,onClick:y,className:"w-full font-medium",children:e.jsxs("div",{className:"flex m-auto justify-center items-center gap-2",children:[e.jsx(P,{})," START TYPING"]})})]})]})})})}export{X as default};
